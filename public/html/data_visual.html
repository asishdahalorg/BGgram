<!DOCTYPE html>
<meta charset="utf-8">
<style>

    text {
        font: 12px sans-serif;
    }

</style>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Internal-->
    <link rel="stylesheet" href="../css/browse.css">
    <link rel="stylesheet" href="../css/header2.css">
    <link rel="stylesheet" href="../css/hover.css">

    <script src="../jquery-3.1.1.min.js"></script>
    <script src="../scripts/pixlr.js"></script>
    <script src="../scripts/browse.js"></script>
    <script src="../scripts/login.js"></script>

    <!--External-->
    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase-storage.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react-dom.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href="https://lipis.github.io/bootstrap-social/bootstrap-social.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">BGGram</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><!--class="active">--><a href="aboutus.html">About Us</a></li>
                <li><a href="browse.html">Browse</a></li>
                <li><a href="data_visual.html">Visualization of most searched</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" style="display: none;" data-toggle="dropdown">Editor<span class="caret"></span></a>
                    <ul class="dropdown-menu" style="display: none;" role="menu">
                        <li><a href="#">Create New</a></li>
                        <li><a href="#">Load</a></li>
                        <li class="divider"></li>
                        <li><a href="#">Random</a></li>
                        <li class="divider"></li>
                        <li><a href="#">Something Else</a></li>
                    </ul>
                </li>
                <!-- <li class="searchinput" ><input type="text"  class="form-control" id="pixabaysearch" placeholder="Search"></li>
                <li class='searchinputsubmit'><button type="submit" href="" id="searchimagebtn" class="btn btn-default">Submit</button>
                </li> -->
            </ul>
            <ul id='logmenu' class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" id='username' style="display: none" class="dropdown-toggle" data-toggle="dropdown"><b></b><span class="caret"></span></a>
                    <ul id='loggedinmenu'  style="display: none" class="dropdown-menu" role="menu">
                        <li><a href="uploads.html">My Uploads</a></li>
                        <li class="divider"></li>
                        <li>
                            <button type="submit" id="userlogoff" class="btn btn-primary btn-block">Sign Off</button>
                        </li>
                    </ul>
                    <a href="#" class="dropdown-toggle"  style="display: none" id="logininfo" data-toggle="dropdown"><b></b> <span class="caret"></span></a>
                    <ul id="login-dp" class="dropdown-menu" style="padding: 10px; padding-bottom: 5px; display: none">
                        <li>
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="sr-only" for="useremail">Username / Email</label>
                                    <input type="email" class="form-control" id="useremail" placeholder="Email address" required>
                                </div>
                                <div class="col-md-12">
                                    <label class="sr-only" for="userpass">Password</label>
                                    <input type="password" class="form-control" id="userpass" placeholder="Password" required>
                                </div>
                                <div class="col-md-12">
                                    <button type="submit" id="userlogin" class="btn btn-primary btn-block">Sign in</button>
                                </div>
                                <div class="bottom text-center">
                                    New here ? <a href="register.html"><b>Register</b></a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="container-fluid">
    <div class="row pull-right" style="width:100%">
        <div class="col-lg-6 col-md-6 pull-left"><b><i>This is a visualization of tags used based on either likes or views</i></b></div>
        <div class="col-lg-3 col-md-3 text-right" style="opacity: .3; font-size:12px;"><b><i>Toggle between likes or views</i></b></div>
        <div class="col-lg-3 col-md-3 text-center">
            <button onclick="visualize()" class="btn btn-default likebtn">Likes</button>
            |
            <button onclick="visualize()" class="btn btn-default viewbtn">Views</button>
        </div>
    </div>


</div>
<script src="../d3.v3.min.js"></script>
<script>
    var like;
    function visualize(like) {


        var diameter = 1000,
                format = d3.format(",d"),
                color = d3.scale.category20c();

        var bubble = d3.layout.pack()
                .sort(null)
                .size([diameter, diameter])
                .padding(1.5);

        var svg = d3.select("body").append("div")
                .attr("class", "container main")
                .append("div").attr("class", "row")
                .append("div").attr("class", "col-lg-12")
                .append("svg")
                .attr("width", diameter)
                .attr("height", diameter)
                .attr("class", "bubble");


        var safesearch = 'false';
        var order = 'popular';
        var maxresult = '200';
        // var searchinput = $("#pixabaysearch").val();
        var phototype = 'photo';
        var min_height = '700';
        var orientation = 'horizontal';
        var API_KEY = '3381729-f41882d53be3b6ccca98a6179';
        var URL = "https://pixabay.com/api/?key=" + API_KEY + "&image_type=" + phototype +
                '&safesearch=' + safesearch + '&order=' + order + '&per_page=' + maxresult + '&min_height=' + min_height +
                '&orientation=' + orientation;

        var total = {};
        var formatted = {
            "name": "flare",
            "children": [
                {
                    "name": "analytics",
                    "children": []
                }
            ]
        };
        var root;
        d3.json(URL, function (error, root) {
            $.each(root.hits, function (i, hit) {
                $.each(hit.tags.split(","), function (i, tag) {
                    var val = total[tag.trim()];
                    var d;
                    if (like){
                        d = hit.likes;
                    }
                    else{
                        d = hit.views;
                    }
                    if (val === parseInt(val, 10))
                        total[tag.trim()] += parseInt(val, 10) + parseInt(d, 10);
                    else
                        total[tag.trim()] = parseInt(d, 10);

                });

            });
            $.each(total, function (i, name) {
                var n = "name";
                var c = "children";
                var s = "size";
                var temp = {};
//            console.log(temp);
                temp[n] = i;
//            console.log(temp);
                temp[c] = [{}];
//            console.log(temp);
                temp[c][0][n] = i;
//            console.log(temp);
                temp[c][0][s] = total[i];
//            console.log(temp);
                formatted[c][0][c].push(temp);
//            console.log(formatted[c][0][c]);

            });
            root = JSON.parse(JSON.stringify(formatted));
            var node = svg.selectAll(".node")
                    .data(bubble.nodes(classes(root))
                            .filter(function (d) {
                                return !d.children;
                            }))
                    .enter().append("g")
                    .attr("class", "node")
                    .attr("transform", function (d) {
                        return "translate(" + d.x + "," + d.y + ")";
                    });

            node.append("title")
                    .text(function (d) {
                        return d.className + ": " + format(d.value);
                    });

            node.append("circle")
                    .attr("r", function (d) {
                        return d.r;
                    })
                    .style("fill", function (d) {
                        return color(d.packageName);
                    });

            node.append("text")
                    .attr("dy", ".3em")
                    .style("text-anchor", "middle")
                    .text(function (d) {
                        return d.className.substring(0, d.r / 3);
                    });

            return formatted;
        });

        // Returns a flattened hierarchy containing all leaf nodes under the root.
        function classes(root) {
            var classes = [];

            function recurse(name, node) {
                if (node.children) node.children.forEach(function (child) {
                    recurse(node.name, child);
                });
                else classes.push({packageName: name, className: node.name, value: node.size});
            }

            recurse(null, root);
            return {children: classes};
        }

        d3.select(self.frameElement).style("height", diameter + "px");
    }

    function deletevisual() {
        $(".main").remove()
    }
    visualize();
    $(document).ready();

    $(".likebtn").click(function () {
        like=true;
        deletevisual();
        $(document).ready();
        visualize(like);

    });
    $(".viewbtn").click(function () {
        like=false;
        deletevisual();
        $(document).ready();
        visualize(like);

    });

</script>
</body>